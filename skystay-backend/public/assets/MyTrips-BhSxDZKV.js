import{u as b,r as d,j as e,a as o}from"./index-DwQX75Pj.js";function N(t){if(!t)return"";const a=new Date(t);return Number.isNaN(a.getTime())?"":a.toLocaleDateString(void 0,{year:"numeric",month:"2-digit",day:"2-digit"})}function g(t,a="USD"){return new Intl.NumberFormat(void 0,{style:"currency",currency:a,maximumFractionDigits:2}).format(Number(t)||0)}function p(){const t=b(l=>{var c,s;return((c=l.userModule)==null?void 0:c.user)||((s=l.userModule)==null?void 0:s.loggedinUser)||null}),[a,i]=d.useState([]),h="USD";d.useEffect(()=>{let l=!1;async function c(){try{if(!t){i([]);return}const s=await o.query({userId:t._id||t.id});l||i(Array.isArray(s)?s:[])}catch{l||i([])}}return c(),()=>{l=!0}},[t]);const n=d.useMemo(()=>a.map(l=>{var m,x,u,j;const c=Number(l.nights)||Math.max(1,Math.ceil((new Date(l.checkOut)-new Date(l.checkIn))/864e5)),s=Number(l.nightlyPrice)||0,r=Number(l.serviceFee)||Math.round(s*c*.05),_=Number(l.totalPrice)||s*c+r;return{id:l._id||`${l.userId}-${l.stayId}-${l.checkIn||""}`,imgUrl:l.imgUrl||((m=l.stay)==null?void 0:m.imgUrl)||"",name:l.stayName||((x=l.stay)==null?void 0:x.name)||((u=l.stay)==null?void 0:u.title)||"Stay",host:l.hostFullname||((j=l.stay)==null?void 0:j.hostFullname)||"",checkIn:l.checkIn,checkOut:l.checkOut,guests:l.guests||1,nightly:s,nights:c,total:_,status:(l.status||"pending").toLowerCase()}}),[a]);async function y(l){const c=s=>s._id||`${s.userId}-${s.stayId}-${s.checkIn||""}`;i(s=>s.filter(r=>c(r)!==l));try{await o.remove(l)}catch{try{const s=await o.query({});i(Array.isArray(s)?s:[])}catch{i([])}}}return e.jsx("div",{style:{minHeight:"calc(100vh - 96px)",display:"flex",flexDirection:"column"},children:e.jsxs("section",{className:"dashboard-listings",style:{flex:"1 0 auto",margin:0,paddingBottom:0},children:[e.jsx("div",{className:"page-title",style:{marginTop:0,marginBottom:0},children:e.jsx("h1",{style:{margin:0},children:"Trips"})}),e.jsx("div",{className:"listing-title",style:{marginTop:12,marginBottom:0},children:n.length?`${n.length} reservations`:"No trips yet"}),e.jsxs("div",{className:"el-table el-table--fit",style:{marginBottom:0},children:[e.jsx("div",{className:"el-table__header-wrapper",children:e.jsxs("table",{className:"el-table__header",cellPadding:"0",cellSpacing:"0",border:"0",children:[e.jsxs("colgroup",{children:[e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{})]}),e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:"Listing"})}),e.jsx("th",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:"Dates"})}),e.jsx("th",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:"Guests"})}),e.jsx("th",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:"Nightly"})}),e.jsx("th",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:"Nights"})}),e.jsx("th",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:"Total"})}),e.jsx("th",{className:"el-table__cell is-right",children:e.jsx("div",{className:"cell",children:"Actions"})})]})})]})}),e.jsx("div",{className:"el-table__body-wrapper",children:e.jsxs("table",{className:"el-table__body",cellPadding:"0",cellSpacing:"0",border:"0",children:[e.jsxs("colgroup",{children:[e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{}),e.jsx("col",{})]}),e.jsx("tbody",{children:n.map(l=>e.jsxs("tr",{className:"el-table__row",children:[e.jsx("td",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:e.jsxs("div",{className:"listing-preview",children:[e.jsx("img",{src:l.imgUrl||"https://via.placeholder.com/70",alt:""}),e.jsx("p",{className:"listing-name",children:l.name})]})})}),e.jsx("td",{className:"el-table__cell",children:e.jsxs("div",{className:"cell",children:[N(l.checkIn)," â€“ ",N(l.checkOut)]})}),e.jsx("td",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:l.guests})}),e.jsx("td",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:g(l.nightly,h)})}),e.jsx("td",{className:"el-table__cell",children:e.jsx("div",{className:"cell",children:l.nights})}),e.jsx("td",{className:"el-table__cell is-right",children:e.jsx("div",{className:"cell",children:g(l.total,h)})}),e.jsx("td",{className:"el-table__cell is-right",children:e.jsxs("div",{className:"cell",children:[e.jsx("span",{className:`status ${l.status}`,"data-status":l.status,children:l.status}),e.jsx("button",{className:"cancel-btn",onClick:()=>y(l.id),children:"Cancel"})]})})]},l.id))})]})})]})]})})}export{p as MyTrips,p as default};
